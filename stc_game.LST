C51 COMPILER V9.51   STC_GAME                                                              09/04/2018 16:29:46 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE STC_GAME
OBJECT MODULE PLACED IN stc_game.OBJ
COMPILER INVOKED BY: H:\Keil\C51\BIN\C51.EXE stc_game.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <STC15F2K60S2.h>
   2          #include <stdlib.h>
   3          #define uint unsigned int
   4          #define uchar unsigned char
   5          
   6          /**********************
   7          函数名称：void init_sys()
   8          功能描述：系统初始化，功能是配置IO口
   9          ***********************/
  10          void init_sys()
  11          {
  12   1        P0M0=0xff;
  13   1        P0M1=0x00;
  14   1        P2M0=0x08;
  15   1        P2M1=0x00;
  16   1        P3M0=0x10;
  17   1        P3M1=0x00;
  18   1        P4M0=0x00;
  19   1        P4M1=0x00;
  20   1        P5M0=0x00;
  21   1        P5M1=0x00;
  22   1      }
  23          void init()             
  24          {
  25   1        TMOD=0x11;
  26   1        TH0=0xD8;
  27   1        TL0=0xEF;
  28   1        EA=1;
  29   1        ET0=1;
  30   1        TR0=0;
  31   1        ET1=1;
  32   1        TR1=1;
  33   1      }
  34          uchar flag = 0;  //数码管选择
  35          uchar i = 0;
  36          uchar tmp = 0;
  37          uchar next = 0;
  38          uint count = 0;
  39          uint shift_time = 530;
  40          uchar show_b[]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};   //barrier 8-bit segments show
  41          uchar show_f[]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};   //final 8-bit show
  42          uchar weixuan[]={0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07};  
  43          void gameScreen();
  44          
  45          /**********************
  46          void main() main function
  47          ***********************/
  48          void main()
  49          {
  50   1        init_sys();
  51   1        init();
  52   1        P0=0x00;
  53   1        gameScreen();
  54   1        while(1);
  55   1      }
C51 COMPILER V9.51   STC_GAME                                                              09/04/2018 16:29:46 PAGE 2   

  56          
  57          void gameScreen(){
  58   1        P0 = 0;
  59   1        flag = flag%8;
  60   1        P2 = weixuan[flag];
  61   1        P0 = show_f[flag];
  62   1        if(count == shift_time){
  63   2          for(i=7;i>0;i--){
  64   3            show_b[i] = show_b[i-1];
  65   3            show_f[i] = show_b[i];
  66   3          }
  67   2          tmp =  rand()%3;
  68   2          switch(tmp){
  69   3            case 0: next = 0x01; break;   //show_b[0] is an original resource used to copy musicode to next location
             -.
  70   3            case 1: next = 0x40; break;
  71   3            case 2: next = 0x08; break;
  72   3          }
  73   2          show_b[0] = next;
  74   2          show_f[0] = show_b[0];
  75   2          count = 0;
  76   2        }
  77   1      }
  78          
  79          void timer0() interrupt 1{
  80   1        TH0=(65535-1000)/256;     //重新装载定时器0的初始值，为了下一次定时器溢出准备
  81   1        TL0=(65535-1000)%256;
  82   1        gameScreen();
  83   1        flag++;
  84   1      }
  85          
  86          void tim2() interrupt 3   
  87          {
  88   1        TH1=(65536-925)/256;
  89   1        TL1=(65536-925)%256;
  90   1      
  91   1        
  92   1        gameScreen();
  93   1        flag++;
  94   1        count++;
  95   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    318    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
