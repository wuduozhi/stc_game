C51 COMPILER V9.51   STC_GAME                                                              09/04/2018 17:30:48 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE STC_GAME
OBJECT MODULE PLACED IN stc_game.OBJ
COMPILER INVOKED BY: H:\Keil\C51\BIN\C51.EXE stc_game.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <STC15F2K60S2.h>
   2          #include <stdlib.h>
   3          #define uint unsigned int
   4          #define uchar unsigned char
   5          
   6          /**********************
   7          函数名称：void init_sys()
   8          功能描述：系统初始化，功能是配置IO口
   9          ***********************/
  10          void init_sys()
  11          {
  12   1        P0M0=0xff;
  13   1        P0M1=0x00;
  14   1        P2M0=0x08;
  15   1        P2M1=0x00;
  16   1        P3M0=0x10;
  17   1        P3M1=0x00;
  18   1        P4M0=0x00;
  19   1        P4M1=0x00;
  20   1        P5M0=0x00;
  21   1        P5M1=0x00;
  22   1      }
  23          void init()             
  24          {
  25   1        TMOD=0x11;
  26   1        TH0=0xD8;
  27   1        TL0=0xEF;
  28   1        EA=1;
  29   1        ET0=1;
  30   1        TR0=0;
  31   1        ET1=1;
  32   1        TR1=1;
  33   1      }
  34          sbit KEY1 = P3^2;
  35          sbit KEY2 = P3^3;
  36          sbit KEY3 = P1^7;
  37          sbit led_sel=P2^3;
  38          
  39          uint hit = 0;  //击中与否
  40          uint no_hit = 0;
  41          uchar led = 0x3f;  //初始六条命
  42          uchar gameState = 0; //游戏状态
  43          uchar flag = 0;  //数码管选择
  44          uchar i = 0;
  45          uchar tmp = 0;
  46          uchar next = 0;  
  47          uint count = 0;         //数码管移动计数
  48          uint shift_time = 530;  //数码管移动时间
  49          uchar show_b[]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};   //barrier 8-bit segments show
  50          uchar show_f[]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};   //final 8-bit show
  51          uchar weixuan[]={0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07};  
  52          void gameScreen();
  53          void gameOver();
  54          /**********************
  55          void main() main function
C51 COMPILER V9.51   STC_GAME                                                              09/04/2018 17:30:48 PAGE 2   

  56          ***********************/
  57          void main()
  58          {
  59   1        init_sys();
  60   1        init();
  61   1        P0=0x00;
  62   1        gameScreen();
  63   1        while(1);
  64   1      }
  65          
  66          void gameScreen(){
  67   1        
  68   1        //判断点击
  69   1        if(gameState == 0){
  70   2          if(KEY3 == 0){ show_b[6] &= 0xfe; }    //敲击上中下三个位置的音符
  71   2          if(KEY2 == 0){ show_b[6] &= 0xbf; }
  72   2          if(KEY1 == 0){ show_b[6] &= 0xf7; } 
  73   2          
  74   2          show_f[6] |= 0x36;  //敲击提示线
  75   2          
  76   2        }
  77   1        
  78   1        //数码管显示
  79   1        P0 = 0;
  80   1        flag = flag%9;
  81   1        led_sel = 0;
  82   1        if(flag < 8){
  83   2          P2 = weixuan[flag];
  84   2          P0 = show_f[flag];
  85   2        }else{
  86   2          led_sel=1;
  87   2          P0 = led;
  88   2          flag = 0;
  89   2        }
  90   1        
  91   1      
  92   1        
  93   1        if(count == shift_time){ //移动
  94   2          switch(gameState){
  95   3            case 0:
  96   3                for(i=7;i>0;i--){
  97   4                  show_b[i] = show_b[i-1];
  98   4                  show_f[i] = show_b[i];
  99   4                }
 100   3                
 101   3                //生成随机数
 102   3                tmp =  rand()%3;
 103   3                switch(tmp){
 104   4                  case 0: next = 0x01; break;   //show_b[0] is an original resource used to copy musicode to next locat
             -ion.
 105   4                  case 1: next = 0x40; break;
 106   4                  case 2: next = 0x08; break;
 107   4                }
 108   3                show_b[0] = next;
 109   3                show_f[0] = show_b[0];
 110   3                count = 0;
 111   3                
 112   3                //判断是否击中
 113   3                if(show_b[7] != 0x00){
 114   4                  led = led>>1;
 115   4                  no_hit ++;
 116   4                  if(led == 0x00){
C51 COMPILER V9.51   STC_GAME                                                              09/04/2018 17:30:48 PAGE 3   

 117   5                    gameState = 1;
 118   5                    gameOver();
 119   5                  }
 120   4                }else{
 121   4                  hit++;
 122   4                }
 123   3                
 124   3              default:
 125   3                gameOver();
 126   3          }
 127   2        }
 128   1      }
 129          
 130          void gameOver(){
 131   1        show_f[0] = 0x76;
 132   1        show_f[1] = hit/100;
 133   1        show_f[2] = (hit%100)/10;
 134   1        show_f[3] = hit%10;
 135   1        show_f[4] = 0x37;
 136   1        show_f[5] = no_hit/100;
 137   1        show_f[6] = (no_hit%100)/10;
 138   1        show_f[7] = no_hit%10;
 139   1      
 140   1      }
 141          
 142          void timer0() interrupt 1{
 143   1        TH0=(65535-1000)/256;     //重新装载定时器0的初始值，为了下一次定时器溢出准备
 144   1        TL0=(65535-1000)%256;
 145   1        gameScreen();
 146   1        flag++;
 147   1      }
 148          
 149          void tim2() interrupt 3   
 150          {
 151   1        TH1=(65536-925)/256;
 152   1        TL1=(65536-925)%256;
 153   1        gameScreen();
 154   1        flag++;
 155   1        count++;
 156   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    527    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     38    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
